<!--
  @file: tasktracker.md
  @description: Трекер задач проекта MemoMed AI с приоритетами и статусами
  @dependencies: project.md
  @created: 2026-02-22
-->

# MemoMed AI -- Трекер задач

> Последнее обновление: 2026-02-24 (v0.3.0: персонализация напоминаний, coverage 80%, 268 тестов)

**Статусы**: Не начата | В процессе | Завершена | Отложена | Отменена
**Приоритеты**: Критический | Высокий | Средний | Низкий

---

## Этап 1: MVP (v1.0) -- Срок: Апрель 2026

### Задача: Инициализация проекта

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Создание структуры проекта, настройка Next.js, TypeScript, Tailwind, Prisma, Docker
- **Шаги выполнения**:
  - [x] Инициализация Next.js 16 с App Router и TypeScript
  - [x] Настройка Tailwind CSS v4 и shadcn/ui
  - [x] Настройка Prisma 7 + PostgreSQL schema (12 моделей)
  - [x] Настройка Docker (docker-compose: app, worker, postgres, redis)
  - [x] Настройка ESLint, Prettier, Husky (pre-commit hooks)
  - [x] Настройка Vitest + Testing Library + MSW для тестов
  - [x] Создание базовой структуры папок (src/app, src/components, src/lib)
  - [x] Git init + .gitignore + первый коммит
  - [x] GitHub Actions CI (lint + type-check + tests на push/PR)
  - [x] E2E тесты Playwright (публичные страницы, dev-login → дашборд → лекарства)
  - [x] Integration-тест API: POST /api/locale
- **Зависимости**: Нет

### Задача: Аутентификация

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Регистрация, вход, JWT, роли (patient/relative)
- **Шаги выполнения**:
  - [x] Настройка NextAuth.js v5 (Credentials Provider, JWT-стратегия)
  - [x] Prisma-модели: users, profiles
  - [x] API: POST /api/auth/register
  - [x] API: POST /api/auth/login (через NextAuth signIn)
  - [x] Middleware проверки JWT на защищённых маршрутах
  - [x] Страницы: login, register (адаптивный дизайн, Server Actions)
  - [x] Форма согласия на обработку персональных данных (ФЗ-152) при регистрации
  - [x] Отдельный чекбокс: участие в программе обратной связи (опционально)
  - [x] Хранение токена в httpOnly cookie (JWT через NextAuth)
  - [x] Unit-тесты: валидация, хэширование, JWT (5 тестов)
- **Зависимости**: Инициализация проекта

### Задача: CRUD лекарств

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Добавление, редактирование, удаление, просмотр лекарств
- **Шаги выполнения**:
  - [x] Prisma-модель: medications (в схеме из предыдущей задачи)
  - [x] API: GET /api/medications (список по пациенту)
  - [x] API: POST /api/medications (создание)
  - [x] API: PATCH /api/medications/:id (редактирование)
  - [x] API: DELETE /api/medications/:id (архивирование, soft delete)
  - [x] Zod-схемы валидации (createMedicationSchema, updateMedicationSchema)
  - [x] Страница: список лекарств (MedicationCard компонент)
  - [x] Страница: форма добавления/редактирования лекарства (MedicationForm)
  - [x] Тесты схем валидации (11 тестов)
- **Зависимости**: Аутентификация

### Задача: Главный экран пациента

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Экран с часами, названием лекарства и большой кнопкой подтверждения
- **Шаги выполнения**:
  - [x] Компонент: LiveClock (живые часы с русской локалью)
  - [x] Компонент: TakeMedicationButton (большая кнопка, анимация успеха)
  - [x] Компонент: NextMedicationCard (ближайшее лекарство с таймером)
  - [x] Динамический фон: DynamicBackground (градиент по времени суток)
  - [x] Логика: getNextMedication (определение ближайшего лекарства)
  - [x] Запись medication_log при нажатии кнопки (Server Action)
  - [x] Адаптивный дизайн (mobile-first, BottomNav)
  - [x] API: POST /api/logs, POST /api/logs/sync (офлайн-синхронизация)
- **Зависимости**: CRUD лекарств

### Задача: Offline-first (PWA)

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Работа без интернета через Service Worker и IndexedDB
- **Шаги выполнения**:
  - [x] Настройка @ducanh2912/next-pwa (Service Worker, Workbox, рантайм-кэш)
  - [x] IndexedDB через Dexie.js: таблицы medications, logs
  - [x] Логика: сохранение лога в IndexedDB при нажатии кнопки (офлайн)
  - [x] Автоматическая синхронизация при восстановлении сети (useOfflineSync)
  - [x] Кэширование страниц через Service Worker (NetworkFirst, CacheFirst)
  - [x] Компонент: OfflineIndicator, SyncStatus
  - [x] Хук: useOffline, useOfflineSync
  - [x] Тесты: saveLogOffline, getPendingLogsCount, ошибка сети (3 теста)
- **Зависимости**: Главный экран пациента

### Задача: Синхронизация данных

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Критический
- **Описание**: Пакетная синхронизация offline-логов с сервером
- **Шаги выполнения**:
  - [x] Prisma-модель: medication_logs (syncStatus: pending/synced)
  - [x] API: POST /api/logs/sync (пакетная загрузка, до 100 записей)
  - [x] Логика разрешения конфликтов (Last Write Wins по createdAt)
  - [x] Обновление syncStatus в IndexedDB после успешной синхронизации
  - [x] Тесты: ошибка сети, saveLogOffline
- **Зависимости**: Offline-first

### Задача: Связь пациент-родственник

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Инвайт-код для связывания аккаунтов
- **Шаги выполнения**:
  - [x] Prisma-модель: connections (уже в схеме)
  - [x] inviteCode генерируется автоматически при создании пользователя (cuid)
  - [x] API: POST /api/connections/link (привязка по коду)
  - [x] API: DELETE /api/connections/:id (отключение, status=inactive)
  - [x] Rate limiting: 5 попыток в час через Redis
  - [x] Страница /invite: показ и копирование кода (для пациента)
  - [x] Страница /connect: форма ввода кода (для родственника)
  - [x] Server Actions: connectToPatientAction, disconnectFromPatientAction
- **Зависимости**: Аутентификация

### Задача: Живая лента для родственника

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Real-time лента событий через Server-Sent Events
- **Шаги выполнения**:
  - [x] API: GET /api/feed (SSE endpoint, 5-сек интервал, TTL 5 мин)
  - [x] API: GET /api/feed/events (REST polling fallback)
  - [x] Компонент: LiveFeed (SSE → polling переключение, статус подключения)
  - [x] Компонент: FeedItem (зелёный/жёлтый/красный по задержке)
  - [x] Цвета: зелёный (вовремя), жёлтый (до 30 мин), красный (>30 мин / пропуск)
  - [x] Хук: useLiveFeed (SSE + polling fallback, дедупликация)
  - [x] Тесты: getEventColor (6 тестов), formatDelay (4 теста)
- **Зависимости**: Связь пациент-родственник, Синхронизация данных

### Задача: AI-чат помощник (DeepSeek)

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Чат с AI для ответов на вопросы о лекарствах
- **Шаги выполнения**:
  - [x] DeepSeek service: `src/lib/ai/deepseek.service.ts` (OpenAI SDK + baseURL)
  - [x] Системный промпт: `src/lib/ai/prompts/chat.prompt.ts`
  - [x] API: POST /api/ai/chat (стриминг через ReadableStream)
  - [x] Prisma-модель: chat_messages (серверное хранение истории)
  - [x] Token budget: Redis counter, лимит 50K/месяц, checkTokenBudget/incrementTokenUsage
  - [x] Медицинский дисклеймер: AiDisclaimerModal (первый запуск → LocalStorage)
  - [x] Дисклеймер в каждом ответе AI
  - [x] Redis-кэширование ответов (TTL 1 час, SHA256-хэш ключа)
  - [x] Rate limiting: 20 запросов / 15 минут через Redis
  - [x] Компонент: AiChat (стриминг, история, очистка)
  - [x] Компонент: MessageBubble (user/assistant, анимация печати)
  - [x] Компонент: ChatInput (отправка по Enter/кнопке)
  - [x] Компонент: ChatSuggestions (4 быстрых вопроса)
  - [x] Хук: useAiChat (стриминг + история + abort)
  - [x] Страницы: /chat (patient), /chat (relative)
- **Зависимости**: Аутентификация

### Задача: Docker-деплой

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Контейнеризация и деплой на VPS
- **Шаги выполнения**:
  - [x] Dockerfile multi-stage build (base→deps→build-deps→builder→runner)
  - [x] docker-compose.yml (nginx, app, worker, postgres, redis + healthchecks)
  - [x] nginx.conf (SSL, gzip, rate limit, SSE/streaming без буферизации)
  - [x] .env.example обновлён (VAPID, S3, все переменные)
  - [x] Health check endpoint: GET /api/health
  - [x] scripts/deploy.sh (backup, migrate, build, wait, prune)
  - [x] docs/deployment.md — инструкция по деплою
- **Зависимости**: Все задачи этапа 1

---

## Этап 2: Доработки (v1.1) -- Срок: Май 2026

### Задача: Календарь дисциплины

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Визуальный календарь для родственника и врача с цветовой индикацией дней
- **Шаги выполнения**:
  - [x] API: GET /api/calendar/:patientId?month=YYYY-MM
  - [x] Компонент: calendar-view (месячная сетка с цветными ячейками)
  - [x] Логика цветов: зелёный (100%), жёлтый (1-2 пропуска), красный (3+)
  - [x] Клик по дню → детализация (список лекарств и статусы)
  - [x] Статистика за месяц (процент дисциплины)
  - [x] Интеграция на /stats (пациент), /doctor/patients/[id] (врач), /patients/[id] (родственник)
- **Зависимости**: Живая лента

### Задача: Web Push напоминания

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Система эскалации уведомлений (T+0, T+10, T+20, T+30)
- **Шаги выполнения**:
  - [x] Настройка Web Push API (VAPID keys)
  - [x] Подписка пользователя на push-уведомления
  - [x] BullMQ worker: reminder.job.ts (4 отложенных задачи на каждый приём)
  - [x] Логика отмены при подтверждении приема (takeMedicationAction, API logs, logs/sync)
  - [x] T+30: push родственнику
  - [x] Крон: schedule-reminders.job.ts — каждую минуту планирует напоминания
  - [x] Интеграция: scheduleReminders при createMedication (API + Server Action)
  - [x] Unit-тесты: buildMedicationReminderPayload, schedule-utils (computeNextScheduledAt, jobId)
- **Зависимости**: Docker-деплой, Связь пациент-родственник

### Задача: Загрузка фото лекарств

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Фото упаковки для идентификации лекарства
- **Шаги выполнения**:
  - [x] Компонент: photo-upload (камера + галерея + drag-and-drop)
  - [x] API: POST /api/medications/:id/photo (загрузка) и DELETE (удаление)
  - [x] Хранение: локальная файловая система / S3-совместимое хранилище (абстракция)
  - [x] Оптимизация: сжатие до 500px ширины, WebP через Canvas API на клиенте
  - [x] Отображение на карточке лекарства
  - [x] Тесты: storage.service (5 тестов)
- **Зависимости**: CRUD лекарств

### Задача: Статистика и дашборд

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Дашборд с метриками дисциплины
- **Шаги выполнения**:
  - [x] API: GET /api/stats/:patientId (агрегированные данные, период 7/14/30/90 дней)
  - [x] Бизнес-логика: `src/lib/stats/stats.service.ts` (чистые функции, тестируемые без БД)
  - [x] Метрики: процент дисциплины, среднее опоздание, текущий/рекордный streak
  - [x] Компонент: StatsCards (4 карточки с цветовой индикацией)
  - [x] Компонент: DisciplineChart (SVG столбчатая диаграмма с тултипами)
  - [x] Компонент: StatsDashboard (обёртка с переключателем периода)
  - [x] Страница /stats обновлена: дашборд + календарь + отчёты
  - [x] Тесты: 14 тестов (calcAvgDelay, calcStreak, buildDailyTrend, calculateStats)
- **Зависимости**: Синхронизация данных

### Задача: Онбординг

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Обучающие экраны для новых пользователей (особенно пожилых)
- **Шаги выполнения**:
  - [x] 4 экрана с крупными эмодзи-иллюстрациями и простым текстом (OnboardingWizard)
  - [x] Показ при первом входе (onboardingDone в Profile), редирект из /dashboard
  - [x] Кнопка «Пропустить» + навигация шагами (индикаторы-точки)
  - [x] API: POST /api/profile/onboarding (upsert onboardingDone=true)
  - [x] Адаптивный дизайн, шрифт 20px+, кнопки 56px+ (mobile-first, 60+)
- **Зависимости**: Главный экран пациента

### Задача: Text-to-Speech для напоминаний

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Низкий
- **Описание**: Голосовое озвучивание напоминаний через Web Speech API (опциональная настройка)
- **Шаги выполнения**:
  - [x] Настройка в профиле пользователя: включить/выключить TTS (страница /settings)
  - [x] Интеграция Web Speech API (хук useTts + компонент TtsSettings)
  - [x] Выбор голоса (из доступных системных, фильтр по ru-RU)
  - [x] Регулировка скорости (0.5–2.0x) и громкости
  - [x] Автоозвучивание напоминания в TakeMedicationButton при autoAnnounce=true
- **Зависимости**: Web Push напоминания

---

## Этап 3: Аналитика (v1.2) -- Срок: Июнь 2026

### Задача: Дневник самочувствия

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Ежедневная запись настроения, боли, сна, энергии
- **Шаги выполнения**:
  - [x] Prisma-модель: health_journal (уже была в схеме)
  - [x] API: GET/POST /api/journal + POST /api/journal/sync (batch offline sync)
  - [x] Страница: /journal (список 30 дней) + /journal/[date] (форма записи)
  - [x] Форма с ползунками (1-5): настроение, боль, сон, энергия + свободный текст
  - [x] Offline-поддержка: сохранение в IndexedDB (version 2) при отсутствии сети
  - [x] IndexedDB версия 2: добавлена таблица journal
  - [x] Тесты: journalEntrySchema (9 тестов)
- **Зависимости**: Offline-first

### Задача: Интеграция метеоданных

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Низкий
- **Описание**: Получение погодных данных для корреляционного анализа
- **Шаги выполнения**:
  - [x] Prisma-модель: meteo_logs (temperature, humidity, pressure, weatherMain, regionCode)
  - [x] Интеграция OpenWeather API (cron: каждые 3 часа, опциональная через OPENWEATHER_API_KEY)
  - [x] Worker job: fetch-weather.job.ts (BullMQ, concurrency 3, опускает если нет API-ключа)
  - [x] Хранение: давление, влажность, температура, описание погоды, индекс геомагнитной активности
  - [x] Интеграция метеоданных в AI-промпт analyze.prompt.ts (корреляции погода → самочувствие)
  - [x] Обновлён .env.example: OPENWEATHER_API_KEY
- **Зависимости**: Docker-деплой

### Задача: AI-анализ корреляций

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: DeepSeek анализирует связи между приёмом лекарств и самочувствием
- **Шаги выполнения**:
  - [x] Промпт: `src/lib/ai/prompts/analyze.prompt.ts` (структурированный JSON-вывод)
  - [x] API: GET /api/analysis/:patientId (по запросу, не cron — экономит ресурсы)
  - [x] Формат: паттерны (correlation/trend/anomaly), уверенность, рекомендации, riskLevel
  - [x] Компонент: AnalysisResults (кнопка запуска, паттерны, рекомендации, дисклеймер)
  - [x] Кэширование в Redis (TTL 24 часа), Rate limit 3 запроса/час
  - [x] Graceful fallback при ошибке AI (показывает базовые метрики)
  - [x] Интегрировано на страницу /stats
- **Зависимости**: Дневник самочувствия

### Задача: Экспорт отчётов для врача

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: PDF-отчёт с историей приёмов и аналитикой
- **Шаги выполнения**:
  - [x] Промпт: report.prompt.ts (генерация текстового резюме DeepSeek, graceful fallback)
  - [x] Генерация PDF: @react-pdf/renderer, кириллица (шрифт Roboto), компонент PdfReport
  - [x] API: GET /api/reports/:patientId?period=30d (rate limit 5/час)
  - [x] Содержание: дисциплина, лекарства, симптомы из дневника, отзывы, AI-резюме для врача
  - [x] Компонент DownloadReportButton: прогресс, обработка ошибок, blob-скачивание
- **Зависимости**: AI-анализ корреляций

### Задача: Сбор обратной связи по лекарствам

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Система сбора отзывов пациентов о лекарствах (бизнес-модель)
- **Шаги выполнения**:
  - [x] Prisma-модель: medication_feedback (effectivenessScore, sideEffects, freeText, aiAnalysis)
  - [x] Страница /feedback: форма отзыва (оценка звёздочками, побочки, свободный текст)
  - [x] Компонент FeedbackForm: i18n поддержка ru/en
  - [x] AI-обработка: feedback-analyzer.ts (DeepSeek извлекает структурированные данные)
  - [x] Анонимизация: данные хранятся без прямой идентификации в aiAnalysis
  - [x] API: POST /api/feedback (rate limit 10/час), GET /api/feedback/aggregate
  - [x] Тесты: 11 тестов Zod-схемы feedback.schema
  - [x] Навигация: кнопка «Отзывы» в BottomNav пациента
- **Зависимости**: AI-чат помощник

---

## Этап 4: Мобильные приложения (v2.0) -- Срок: Июль 2026

### Задача: Capacitor для Android

- **Статус**: Завершена ✅ (2026-02-22, конфигурация и инфраструктура)
- **Приоритет**: Средний
- **Описание**: Упаковка PWA в Android-приложение
- **Шаги выполнения**:
  - [x] Установка: @capacitor/core, @capacitor/cli, @capacitor/android, @capacitor/push-notifications, @capacitor/camera
  - [x] Конфиг: capacitor.config.ts (appId, appName, Firebase push, Camera, SplashScreen)
  - [x] next.config.ts: BUILD_TARGET=capacitor → static export (output: 'export')
  - [x] Хук use-capacitor.ts: useCapacitorEnv, capturePhotoNative, registerNativePush (graceful деградация)
  - [x] Скрипт: scripts/build-android.sh (debug APK / release AAB)
  - [x] package.json: build:android, android:debug, android:release, android:open
  - [x] Документация: docs/mobile.md (инструкция по сборке, Firebase, отладка)
  - [ ] Публикация в Google Play (требует физическое устройство и Developer Account; чеклист в docs/mobile.md)
- **Зависимости**: Все задачи этапов 1-3

### Задача: Capacitor для iOS

- **Статус**: Отложена (требует macOS + Xcode)
- **Приоритет**: Средний
- **Описание**: Упаковка PWA в iOS-приложение
- **Шаги выполнения**:
  - [ ] Настройка Capacitor для iOS
  - [ ] Адаптация: APNs для push
  - [ ] Сборка IPA
  - [ ] Публикация в App Store
- **Зависимости**: Capacitor для Android

---

## Этап 5: Масштабирование (v2.1) -- Срок: Август 2026

### Задача: Локализация

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Низкий
- **Описание**: Английский язык
- **Шаги выполнения**:
  - [x] Установка next-intl, плагин в next.config.ts
  - [x] Конфиг: src/i18n/request.ts (locale из cookie NEXT_LOCALE)
  - [x] Файлы переводов: messages/ru.json, messages/en.json (8 разделов, ~120 ключей)
  - [x] NextIntlClientProvider в root layout
  - [x] Переключатель языка: LanguageSwitcher в Header (toggle RU/EN, cookie + reload)
  - [x] API POST /api/locale для записи cookie
  - [x] Интеграция useTranslations в BottomNav, FeedbackForm
  - [x] Перевод системных промптов DeepSeek: английский в messages/en.json
- **Зависимости**: Нет

### Задача: Роль "Врач"

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Низкий
- **Описание**: Врач может просматривать статистику своих пациентов
- **Шаги выполнения**:
  - [x] Расширение RBAC: роль doctor (Prisma enum, миграция, TypeScript типы)
  - [x] Форма регистрации: добавлена опция «Врач»
  - [x] Редирект после входа/регистрации на /doctor/dashboard
  - [x] API: GET /api/doctor/patients (список подключённых пациентов + дисциплина 30 дн.)
  - [x] Страница: /doctor/dashboard (список пациентов с % дисциплины)
  - [x] Страница: /doctor/patients/[patientId] (лекарства, статистика, AI-анализ, отчёты)
  - [x] Layout (doctor): роль-защита + Header + BottomNav
  - [x] Связь через существующую механику Connection (invite-код)
- **Зависимости**: Аутентификация, Статистика

### Задача: Админ-панель

- **Статус**: Завершена ✅ (2026-02-22, расширена 2026-02-22)
- **Приоритет**: Низкий
- **Описание**: Управление промптами, пользователями, аналитика
- **Шаги выполнения**:
  - [x] Layout (admin): боковая навигация, role-guard
  - [x] Страница /admin: обзор — ключевые метрики, распределение ролей, последние регистрации, быстрые ссылки
  - [x] Страница /admin/users: список пользователей с пагинацией, фильтрация по роли
  - [x] Страница /admin/medications: обзор всех лекарств, топ-10 препаратов, поиск, фильтр
  - [x] Страница /admin/connections: связи пациент-родственник, фильтр по статусу
  - [x] Страница /admin/audit: аудит-логи, фильтрация по действию/пользователю
  - [x] Страница /admin/prompts: просмотр и редактирование prompt_templates (CRUD через Server Actions)
  - [x] Страница /admin/stats: статистика AI (токены, запросы, топ-10 пользователей)
  - [x] Компонент PromptEditor: inline-редактирование personaBlock/contextBlock/taskBlock
  - [x] Server Actions: updatePromptAction, deletePromptAction (lib/admin/prompt.actions.ts)
- **Зависимости**: Все задачи этапов 1-3

### Задача: Тестовые данные и режим отладки

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Средний
- **Описание**: Реалистичные тестовые данные для разработки, быстрый вход без паролей
- **Шаги выполнения**:
  - [x] `prisma/seed.ts`: 50 пациентов, 5 врачей, 5 родственников, 1 admin
  - [x] Каждый пациент: 5-10 лекарств из 25 реальных препаратов
  - [x] Логи приёмов за 30 дней (~75% taken, ~15% missed)
  - [x] Записи дневника самочувствия за 14 дней
  - [x] Страница `/dev-login`: мгновенный вход по роли (только dev)
  - [x] `devLoginAction` в `src/lib/auth/dev-actions.ts`
  - [x] `auth.config.ts`: `/dev-login` в публичных маршрутах dev-режима
  - [x] Баннер на `/login` со ссылкой на `/dev-login` (только dev)
  - [x] Кнопка "Dev Login" в шапке `/admin` (только dev)
- **Зависимости**: Схема БД

---

## Этап 6: UX-улучшения (v1.3) — Фев 2026

### Задача: Редизайн страниц и UX-доработки

- **Статус**: Завершена ✅ (2026-02-22)
- **Приоритет**: Высокий
- **Описание**: Редизайн ключевых страниц под единый MedTech стиль, устранение пробелов в навигации
- **Шаги выполнения**:
  - [x] `/doctor/patients/[id]` — геро-карточка, 4 вкладки (обзор/лекарства/дневник/отчёты), дисциплина по препаратам
  - [x] `/journal` (пациент) — пагинация, числовые шкалы /5, прогресс-бары
  - [x] `/stats` (пациент) — обёртка med-page, карточки PDF-отчётов
  - [x] `/history` (пациент) — пагинация 20/стр., фильтры по статусу, группировка по датам
  - [x] `/invite` (пациент) — редизайн, список подключённых с ролями и статусами
  - [x] `/account` (родственник) — СОЗДАНА: профиль, язык, push, выход (путь /account — избежание конфликта с /settings)
  - [x] `/patients/[id]` (родственник) — СОЗДАНА: просмотр статистики, лекарств, дневника пациента
  - [x] `/connect` (родственник) — редизайн в med-page стиле, список подключённых
  - [x] `/doctor/connect` — СОЗДАНА: ввод инвайт-кода, список пациентов
  - [x] `/doctor/dashboard` — пагинация 12/стр., фильтры по дисциплине, поиск по имени
  - [x] `BottomNav` родственника — добавлен пункт «Настройки»
  - [x] `BottomNav` врача — добавлен пункт «Подключить»
  - [x] `FeedItem` — стал кликабельным (ссылка на профиль пациента)
  - [x] `nav-icons.tsx` — добавлен `SearchIcon`
  - [x] Вкладка «Календарь» на `/doctor/patients/[id]` и `/patients/[id]` (родственник)
- **Зависимости**: Все предыдущие этапы

---

## Блокеры и следующая итерация

| Задача                   | Статус   | Требуется                                                              |
| ------------------------ | -------- | ---------------------------------------------------------------------- |
| Capacitor для iOS        | Отложена | macOS + Xcode (см. docs/mobile.md)                                     |
| Публикация в Google Play | Отложена | Устройство Android + Developer Account ($25), чеклист в docs/mobile.md |

**Все задачи, выполнимые на Ubuntu без спецоборудования, завершены.** Для продолжения мобильной разработки потребуется macOS (iOS) или физическое устройство + аккаунт разработчика (Google Play).

---

## Бэклог (опционально)

| Задача                                                    | Приоритет | Описание                                                                                                                                                                                                                                                              |
| --------------------------------------------------------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Переделка всех страниц в стиле /admin**                 | Высокий   | ✅ Завершена. gray→slate, med-card. План: [plan-redesign-admin-style-2026-02-22.md](plan-redesign-admin-style-2026-02-22.md)                                                                                                                                          |
| **PDF-отчёты для админа**                                 | Средний   | ✅ API разрешает admin; блок на /admin/reports; колонка PDF в /admin/users для пациентов                                                                                                                                                                              |
| **Пагинация на страницах с большим количеством объектов** | Средний   | ✅ Добавлена: admin/prompts (10/стр), admin/llm (10/стр), patient/medications (12/стр), patient/feedback (10/стр), relative/connect (10/стр + фильтр по статусу), feed «Показать ещё» (курсорная пагинация). Admin users, medications, connections, audit — уже были. |
| Integration-тесты API                                     | Низкий    | ✅ /api/health, /api/medications, /api/logs, /api/logs/sync, /api/feed/events (с моками)                                                                                                                                                                              |
| Покрытие 80%+                                             | Низкий    | ✅ Завершена. Coverage lib: ~81% lines. Пороги 80%. Добавлены: admin.llm.actions, auth.config, dev-actions. Исправлен llm.actions: apiKey/notes null→undefined для Zod.                                                                                               |
| OpenAPI/Swagger                                           | Низкий    | ✅ docs/api.md — REST API документация (эндпоинты, роли, примеры)                                                                                                                                                                                                     |
| CHANGELOG.md                                              | Низкий    | ✅ История изменений по версиям (Keep a Changelog, [Unreleased] + [0.1.0])                                                                                                                                                                                            |
| **Персонализация напоминаний (LLM)**                      | Средний   | ✅ reminder.prompt.ts, кэш Redis 7д, интеграция в reminder.job (project.md 4.3 #7)                                                                                                                                                                                    |

---

## Ссылки

- [План переделки в стиле /admin](plan-redesign-admin-style-2026-02-22.md) — унификация всех страниц по эталону админ-панели
- [Аудит дизайна MedTech 2026-02-22](design-audit-medtech-2026-02-22.md) — план унификации под MedTech
- [CHANGELOG.md](../CHANGELOG.md) — журнал изменений по версиям
- [Версионирование](versioning.md)
- [Аудит кода и дизайна 2026-02-22](audit-2026-02-22.md)
- [Описание проекта](project.md)
- [REST API](api.md)
- [Дневник разработки](diary.md)
- [Вопросы по архитектуре](qa.md)

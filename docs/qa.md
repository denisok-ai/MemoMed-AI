<!--
  @file: qa.md
  @description: Вопросы по архитектуре проекта MemoMed AI (все решены 2026-02-22)
  @dependencies: project.md
  @created: 2026-02-22
  @updated: 2026-02-22
-->

# MemoMed AI -- Вопросы по архитектуре

> Вопросы, возникшие при проектировании архитектуры.
> Статус: Открыт | Обсуждается | Решён
> **Все вопросы решены 2026-02-22.**

---

## Дизайн и UX

### Q1: Брендинг -- фиолетовый или зелёный как основной цвет?
- **Статус**: Решён
- **Контекст**: В исходных документах (DOC/) есть противоречие. В `memomed_ai_complete_package.md` Primary цвет -- фиолетовый (#7E57C2, "память, интеллект"), а в `project_tz.md` Primary -- зелёный (#4CAF50, "здоровье"). В текущем `project.md` мы заложили фиолетовый как акцентный, зелёный для кнопки подтверждения.
- **Решение**: Фиолетовый (#7E57C2) как основной бренд (навигация, шапка, акценты). Зелёный (#4CAF50) только для кнопки подтверждения приёма и положительных статусов.

### Q2: Нужен ли онбординг (обучающие экраны)?
- **Статус**: Решён
- **Решение**: Отложить на v1.1. В MVP интерфейс должен быть настолько простым, чтобы онбординг не требовался (одна кнопка, крупные элементы).

### Q3: Голосовое сопровождение уведомлений?
- **Статус**: Решён
- **Решение**: Отложить на v1.1. Text-to-Speech через Web Speech API как опциональная настройка в будущем.

---

## Хостинг и инфраструктура

### Q4: VPS-провайдер и расположение сервера
- **Статус**: Решён
- **Решение**: Для MVP -- Timeweb или Selectel (2 CPU, 4GB RAM, 40GB SSD, ~700-1000 руб/мес, дата-центры в РФ). При росте -- переход на Yandex Cloud с managed-сервисами.

### Q5: Доменное имя
- **Статус**: Решён
- **Решение**: `memomed.ru` (~200 руб/год) для MVP. `memomed.ai` ($70-100/год) -- при коммерческом запуске.

### Q6: CI/CD пайплайн
- **Статус**: Решён
- **Решение**: GitHub Actions минимальный (lint + type-check + tests на push). Деплой на VPS через SSH скрипт `scripts/deploy.sh`.

---

## LLM и AI

### Q7: Лимит токенов на пользователя
- **Статус**: Решён
- **Решение**: 50 000 токенов/месяц на пользователя (~100 сообщений в чате). При достижении лимита -- сообщение "Лимит AI-помощника исчерпан, обновится 1-го числа".

### Q8: Хранение истории чата
- **Статус**: Решён
- **Решение**: Хранить в БД. Таблица `chat_messages` (userId, role, content, tokensUsed, createdAt). Хранение 30 дней, затем автоочистка. Позволяет: продолжение диалога после перезагрузки, анализ частых вопросов, контроль token budget.

### Q9: Медицинский дисклеймер
- **Статус**: Решён
- **Решение**: В MVP -- обязательный дисклеймер при первом использовании чата + напоминание в каждом ответе AI ("При любых сомнениях обратитесь к врачу"). Системный промпт содержит запрет на диагнозы. Консультация юриста -- при коммерциализации.

### Q10: RAG для базы лекарств
- **Статус**: Решён
- **Решение**: Отложить на v1.2. Для MVP -- базовые знания DeepSeek + дисклеймер. RAG с реестром ГРЛС -- значительная сложность, не оправдана на этапе MVP.

---

## Бизнес-модель

### Q11: Формат обратной связи для фарм-компаний
- **Статус**: Решён
- **Решение**: Freemium-модель аналитики:
  - **Бесплатно**: минимальный набор агрегированных данных (средняя оценка, top побочных эффектов)
  - **Подписка**: глубокая аналитика (корреляции с возрастом/полом, тренды, сегментация)
  - Анонимизация: удаление имени, email, замена userId на хэш

### Q12: Согласие на сбор данных (GDPR/ФЗ-152)
- **Статус**: Решён
- **Решение**: Обязательно в MVP. При регистрации: (1) политика обработки персональных данных, (2) отдельный чекбокс на участие в программе обратной связи (опционально).

---

## Технические вопросы

### Q13: Версия Node.js и пакетный менеджер
- **Статус**: Решён
- **Решение**: Node.js 20 LTS, npm. Версия зафиксирована в `.nvmrc`.

### Q14: Стратегия миграций при обновлении схемы
- **Статус**: Решён
- **Решение**: Prisma Migrate в dev-режиме. Production: `prisma migrate deploy` в скрипте деплоя.

### Q15: Мониторинг расхода токенов DeepSeek
- **Статус**: Решён
- **Решение**: Redis counter `ai:tokens:{userId}:{YYYY-MM}` с TTL 35 дней. Ежедневный worker суммирует и сохраняет в PostgreSQL таблицу `ai_usage_stats`.

---

## Ссылки

- [Описание проекта](project.md)
- [Трекер задач](tasktracker.md)
- [Дневник разработки](diary.md)

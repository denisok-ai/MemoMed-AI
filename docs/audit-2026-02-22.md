<!--
  @file: audit-2026-02-22.md
  @description: Аудит кода и дизайна MemoMed AI
  @created: 2026-02-22
-->

# Аудит кода и дизайна MemoMed AI

> Дата: 2026-02-22

---

## 1. Аудит кода

### 1.1 Сильные стороны

| Область         | Оценка | Детали                                                                      |
| --------------- | ------ | --------------------------------------------------------------------------- |
| TypeScript      | ✅     | Нет `any`, strict mode                                                      |
| Безопасность    | ✅     | Нет `dangerouslySetInnerHTML`, `eval`, `innerHTML`                          |
| API авторизация | ✅     | Все защищённые API проверяют `auth()`, 401/403                              |
| Валидация       | ✅     | Zod на входах API (medications, connections, logs, journal, feedback, push) |
| RBAC            | ✅     | Роли проверяются (patient, relative, doctor, admin)                         |
| Rate limiting   | ✅     | connections/link, feedback, reports, ai/chat                                |
| Структура       | ✅     | Разделение app/, components/, lib/, hooks/                                  |
| Документация    | ✅     | Заголовки @file в файлах                                                    |

### 1.2 Рекомендации по коду

| Проблема               | Файлы                                                  | Рекомендация                                                                           |
| ---------------------- | ------------------------------------------------------ | -------------------------------------------------------------------------------------- |
| Пустые catch           | medications/route.ts, log-actions.ts, ai/chat, storage | Добавить `console.warn` или логирование при ошибках scheduleReminders, cancelReminders |
| Placeholder "XXXXXXXX" | connect-form.tsx                                       | Заменить на "Введите код" или i18n-ключ                                                |
| dev-actions            | DEV_PASSWORD в коде                                    | Приемлемо для dev-only; убедиться, что NODE_ENV проверяется                            |

### 1.3 Потенциальные улучшения

- **Аудит-логирование**: расширить для критичных операций (удаление связи, смена роли)
- **Обработка ошибок API**: единый формат `{ error: string, code?: string }`
- **Валидация patientId в URL**: в /api/stats/[patientId], /api/analysis/[patientId] — проверка доступа (собственный пациент или родственник/врач)

---

## 2. Аудит дизайна

### 2.1 Сильные стороны

| Область         | Оценка | Детали                                                          |
| --------------- | ------ | --------------------------------------------------------------- |
| Design System   | ✅     | CSS-переменные в globals.css (primary, success, warning, error) |
| Touch targets   | ✅     | Глобально min 48×48px для button, a                             |
| Focus           | ✅     | :focus-visible с outline 3px                                    |
| Консистентность | ✅     | med-card, med-btn-primary, med-page классы                      |
| aria-\*         | ✅     | aria-label, aria-live в ключевых компонентах                    |
| Шрифт body      | ✅     | 1.125rem (18px) — соответствует 60+                             |

### 2.2 Замечания по доступности (60+)

| Проблема                    | Где                                      | Рекомендация                                                               |
| --------------------------- | ---------------------------------------- | -------------------------------------------------------------------------- |
| text-xs (12px)              | patients/[id], header, admin, feed-item  | Заменить на text-sm (14px) минимум для вторичного текста; основной — 18px+ |
| text-sm (14px)              | Много мест                               | Для второстепенного текста допустимо; для важного — 18px                   |
| min-h-[40px], min-h-[44px]  | chat-suggestions, live-feed, sync-status | Увеличить до 48px для зоны нажатия                                         |
| journal-form getSliderColor | Хардкод #4caf50, #f44336                 | Использовать var(--color-success), var(--color-error)                      |

### 2.3 Консистентность цветов

- **globals.css** — единый источник токенов
- **journal-form.tsx** — хардкод hex вместо токенов
- **pdf-report.tsx** — отдельная палитра (допустимо для PDF)

### 2.4 Рекомендации по UX

- Добавить `lang` на html (next-intl обычно делает)
- Проверить контрастность текста на фоне (WCAG AAA)
- Loading states: убедиться, что все формы показывают индикатор загрузки

---

## 3. Итоговая оценка

| Категория               | Оценка | Комментарий                                   |
| ----------------------- | ------ | --------------------------------------------- |
| Безопасность            | 9/10   | Валидация, auth, rate limit на месте          |
| Качество кода           | 8/10   | Чистый TS, структура; доработать логирование  |
| Доступность             | 7/10   | Базовые меры есть; text-xs/min-h нарушают 60+ |
| Консистентность дизайна | 8/10   | Design system; единичные хардкоды             |

---

## 4. Приоритеты исправлений

1. **Высокий**: Заменить text-xs на text-sm в ключевых UI (пациент, родственник)
2. **Средний**: Увеличить min-h до 48px в chat-suggestions, sync-status
3. **Низкий**: Логирование в пустых catch; замена хардкода цветов в journal-form
